<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmoTracker</title>
    <link rel="stylesheet" href="css/styles.css">
    <meta name="description" content="Real-time facial emotion detection using AI">
    <meta name="theme-color" content="#0f0f1a">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>EmoTracker</h1>
            <p class="tagline">Real-time Facial Emotion Detection</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Sidebar -->
            <aside class="sidebar sidebar-left">
                <div class="panel">
                    <h3 class="panel-title">Controls</h3>
                    <div class="shortcuts-list">
                        <div class="shortcut-item">
                            <kbd>Space</kbd>
                            <span>Start / Stop</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>C</kbd>
                            <span>Calibrate</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>S</kbd>
                            <span>Screenshot</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>F</kbd>
                            <span>Fullscreen</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>T</kbd>
                            <span>Toggle Theme</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Esc</kbd>
                            <span>Exit / Close</span>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3 class="panel-title">Settings</h3>
                    <div class="settings-list">
                        <div class="setting-row">
                            <label for="smoothing-slider">Smoothing</label>
                            <div class="setting-control">
                                <input type="range" id="smoothing-slider" min="0" max="100" value="30">
                                <span id="smoothing-value">0.30</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="stability-slider">Stability</label>
                            <div class="setting-control">
                                <input type="range" id="stability-slider" min="1" max="20" value="5">
                                <span id="stability-value">5</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="confidence-slider">Confidence</label>
                            <div class="setting-control">
                                <input type="range" id="confidence-slider" min="10" max="90" value="50">
                                <span id="confidence-value">50%</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="theme-toggle">Dynamic Theme</label>
                            <input type="checkbox" id="theme-toggle" class="toggle-checkbox" checked>
                        </div>
                        <div class="setting-row">
                            <label for="attention-toggle">Show Attention</label>
                            <input type="checkbox" id="attention-toggle" class="toggle-checkbox" checked>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3 class="panel-title">Camera</h3>
                    <select id="camera-select" class="camera-select" disabled>
                        <option value="">Select Camera</option>
                    </select>
                </div>
            </aside>

            <!-- Center Content -->
            <section class="center-content">
                <!-- Loading overlay -->
                <div id="loading-overlay" class="loading-overlay">
                    <div class="loader"></div>
                    <p id="loading-text">Loading AI models...</p>
                </div>

                <!-- Video container -->
                <div class="video-wrapper">
                    <div class="video-container" id="video-container">
                        <video id="video" autoplay muted playsinline></video>
                        <canvas id="overlay"></canvas>
                        
                        <!-- Attention indicator -->
                        <div id="attention-indicator" class="attention-indicator hidden">
                            <span class="attention-dot"></span>
                            <span id="attention-text">Looking at camera</span>
                        </div>

                        <!-- Fatigue indicators -->
                        <div id="fatigue-indicators" class="fatigue-indicators hidden">
                            <span class="fatigue-item" title="Blinks">
                                <span class="fatigue-icon">üëÅ</span>
                                <span id="blink-count">0</span>
                            </span>
                            <span class="fatigue-item" title="Yawns">
                                <span class="fatigue-icon">üòÆ</span>
                                <span id="yawn-count">0</span>
                            </span>
                        </div>

                        <!-- Fullscreen button -->
                        <button id="fullscreen-btn" class="btn-fullscreen" title="Fullscreen (F)">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Primary emotion display -->
                    <div class="primary-emotion" id="primary-emotion">
                        <div class="emotion-emoji" id="emotion-icon">üòê</div>
                        <div class="emotion-details">
                            <span class="emotion-label" id="emotion-name">Waiting...</span>
                            <div class="emotion-badges">
                                <span id="stability-indicator" class="badge badge-stable hidden">Stable</span>
                                <span id="calibrated-indicator" class="badge badge-calibrated hidden">Calibrated</span>
                            </div>
                        </div>
                        <div class="emotion-confidence">
                            <div class="confidence-ring">
                                <svg viewBox="0 0 36 36">
                                    <path class="confidence-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                    <path id="confidence-ring-fill" class="confidence-fill-ring" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                </svg>
                                <span class="confidence-percent" id="confidence-text">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Control buttons -->
                <div class="control-buttons">
                    <button id="start-btn" class="btn btn-start" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Start Camera
                    </button>
                    <button id="stop-btn" class="btn btn-stop" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12"/>
                        </svg>
                        Stop
                    </button>
                    <button id="calibrate-btn" class="btn btn-calibrate" disabled title="Look neutral and click to calibrate">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        Calibrate
                    </button>
                    <button id="screenshot-btn" class="btn btn-screenshot" disabled title="Screenshot (S)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                        Screenshot
                    </button>
                </div>

                <!-- Stats bar -->
                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-value" id="fps-counter">0</span>
                        <span class="stat-label">FPS</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="face-count">0</span>
                        <span class="stat-label">Faces</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="status">Ready</span>
                        <span class="stat-label">Status</span>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="timeline-section">
                    <div class="timeline-header">
                        <h3>Emotion Timeline</h3>
                        <select id="timeline-duration" class="timeline-select">
                            <option value="60">1 min</option>
                            <option value="120">2 min</option>
                            <option value="300" selected>5 min</option>
                        </select>
                    </div>
                    <div class="timeline-chart">
                        <canvas id="timeline-canvas"></canvas>
                    </div>
                </div>
            </section>

            <!-- Right Sidebar -->
            <aside class="sidebar sidebar-right">
                <div class="panel">
                    <h3 class="panel-title">Expression Levels</h3>
                    <div class="expression-list">
                        <div class="expression-item" data-emotion="neutral">
                            <div class="expression-header">
                                <span class="expression-emoji">üòê</span>
                                <span class="expression-name">Neutral</span>
                                <span class="expression-value" id="val-neutral">0%</span>
                            </div>
                            <div class="expression-bar">
                                <div class="expression-fill" id="bar-neutral"></div>
                            </div>
                        </div>
                        <div class="expression-item" data-emotion="happy">
                            <div class="expression-header">
                                <span class="expression-emoji">üòä</span>
                                <span class="expression-name">Happy</span>
                                <span class="expression-value" id="val-happy">0%</span>
                            </div>
                            <div class="expression-bar">
                                <div class="expression-fill" id="bar-happy"></div>
                            </div>
                        </div>
                        <div class="expression-item" data-emotion="sad">
                            <div class="expression-header">
                                <span class="expression-emoji">üò¢</span>
                                <span class="expression-name">Sad</span>
                                <span class="expression-value" id="val-sad">0%</span>
                            </div>
                            <div class="expression-bar">
                                <div class="expression-fill" id="bar-sad"></div>
                            </div>
                        </div>
                        <div class="expression-item" data-emotion="angry">
                            <div class="expression-header">
                                <span class="expression-emoji">üò†</span>
                                <span class="expression-name">Angry</span>
                                <span class="expression-value" id="val-angry">0%</span>
                            </div>
                            <div class="expression-bar">
                                <div class="expression-fill" id="bar-angry"></div>
                            </div>
                        </div>
                        <div class="expression-item" data-emotion="fearful">
                            <div class="expression-header">
                                <span class="expression-emoji">üò®</span>
                                <span class="expression-name">Fearful</span>
                                <span class="expression-value" id="val-fearful">0%</span>
                            </div>
                            <div class="expression-bar">
                                <div class="expression-fill" id="bar-fearful"></div>
                            </div>
                        </div>
                        <div class="expression-item" data-emotion="disgusted">
                            <div class="expression-header">
                                <span class="expression-emoji">ü§¢</span>
                                <span class="expression-name">Disgusted</span>
                                <span class="expression-value" id="val-disgusted">0%</span>
                            </div>
                            <div class="expression-bar">
                                <div class="expression-fill" id="bar-disgusted"></div>
                            </div>
                        </div>
                        <div class="expression-item" data-emotion="surprised">
                            <div class="expression-header">
                                <span class="expression-emoji">üò≤</span>
                                <span class="expression-name">Surprised</span>
                                <span class="expression-value" id="val-surprised">0%</span>
                            </div>
                            <div class="expression-bar">
                                <div class="expression-fill" id="bar-surprised"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3 class="panel-title">Session Analytics</h3>
                    <div class="analytics-list">
                        <div class="analytics-item">
                            <span class="analytics-label">Duration</span>
                            <span class="analytics-value" id="session-duration">0:00</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">First Detection</span>
                            <span class="analytics-value" id="time-to-detect">--</span>
                        </div>
                        <div class="analytics-item highlight">
                            <span class="analytics-label">Most Frequent</span>
                            <span class="analytics-value" id="most-frequent">--</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Avg Confidence</span>
                            <span class="analytics-value" id="avg-confidence">0%</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Attention Rate</span>
                            <span class="analytics-value" id="attention-percent">0%</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Detection Rate</span>
                            <span class="analytics-value" id="detection-rate">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Multi-face panel (hidden by default) -->
                <div class="panel hidden" id="multiface-panel">
                    <h3 class="panel-title">Detected Faces</h3>
                    <div class="multiface-grid" id="multiface-grid"></div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Screenshot Modal -->
    <div id="screenshot-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Session Summary</h3>
                <button id="modal-close" class="btn-close">&times;</button>
            </div>
            <div class="modal-body">
                <canvas id="screenshot-canvas"></canvas>
            </div>
            <div class="modal-footer">
                <button id="download-screenshot" class="btn btn-primary">Download</button>
                <button id="copy-screenshot" class="btn btn-secondary">Copy</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/themes.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/faceDetection.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
